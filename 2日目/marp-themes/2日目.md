---
marp: true
theme: test
class:
  - slide
---

<!-- paginate: true -->

# AI研究会第2回

---

## 目次

1. 前回の復習
2. Dockerを使ってみる
3. Jupyter labを起動してみる
4. Pythonを実行してみる

---

## 前回の復習(SSH)

+ SSHを使うことで遠隔のパソコンにログインできる
* 必要な情報はログイン先の __IPアドレス__ と __ポート番号__ 、__ユーザー名__ 
* コマンドは`ssh -p ポート番号 ユーザー名@IPアドレス`

---

## sshに必要な情報

|IPアドレス|ポート番号|ユーザー名|
|---|---|---|
|133.2.194.164|22|学籍番号の最初をaにしたもの|


---

## 今回使うであろうコマンド(一部復習)

|コマンド名|機能|書式|元ネタ|
|---|---|---|---|
|ls|ディレクトリ(フォルダ)の表示|ls [ディレクトリ名]|listの略|
|mkdir|ディレクトリの作成|mkdir ディレクトリ名|make Directoryの略|
|pwd|作業ディレクトリの表示|pwd|Print Working Directoryの略|
|cd|作業ディレクトリの変更|cd [ディレクトリ名]|Change Directoryの略|

---

## Dockerとは？

__仮想環境__ を作るためのアプリケーション。 仮想環境を __コンテナ__ という単位で生成することができる。コンテナを作るための設計図を __Docker image__ と呼び、簡単に配布できるため複数のパソコンで同じ仮想環境を簡単に用意することができる。


---

## Dockerの利点

例えば以下のような利点がある。

* 開発環境(ローカルのPC)では動いていたけどリモートのLinuxで動かなかった、といったケースを減らすことができる。
* アプリを動かすのに何のパッケージが必要なの？と慌てることも減らせる。
* 環境で悩んだことがない人は天才かプログラミング未経験者。環境でストレスを受けた人たちは、アプリの差はあれど仮想環境に行き着くと思います。未経験者→初心者への登竜門的な存在で、学生で使えるなら「お、プログラミングやったことあるんだね。」と少し一目置かれるかも？

---

## 余談

コーディングとは「プログラミング言語を使ってソースコードを作成すること」。

一方、プログラミングは「プログラムを作成する作業全般」を指します。(ですが余程意識が高い人でなければコーディングをプログラミングと呼びます。)

みなさんが地主先生のC言語の授業でやった「プログラミングだと思っていたもの」は「コーディング」です。

---

## Dockerコンテナの起動準備

Docker imageを作るには、Docker fileというものを書かなければいけないのですが最初は少し難しいのでとりあえず、私が事前に作っているDocker imageを使ってコンテナを作ります。

その前に準備として以下のコマンドを入力してください。
```
cd ~
mkdir work
```
`cd ~`は自分のホームディレクトリに移動するコマンドです。各ユーザーは自分専用のホームディレクトリというものを持っています。

`mkdir work`とはworkというディレクトリを作るコマンドです。今後はこのディレクトリでプログラミングをします。

---

## Docker コンテナの作成

```
docker run --gpus all -it --name $(whoami) --workdir /work -v $(pwd)/work:/work 
-p 指定されたポート番号:8888 cuda1170_ubuntu1804_pytorch_is_latest bash
```

コマンドを解説します。
|オプション名|機能|
|---|---|
|--gpus all|GPUをコンテナから使えるようにするオプション|
|-it | 対話的な提供。おまじないと思っていい。|
|--name $(whoami)|コンテナに名前をつけます。名前はこの場合、`whoami`コマンドの実行結果になります。|

(次ページへ)

---

## Docker コンテナの作成

```
docker run --gpus all -it --name $(whoami) --workdir /work -v $(pwd)/work:/work 
-p 指定されたポート番号:8888 cuda1170_ubuntu1804_pytorch_is_latest bash
```

|オプション名|機能|
|---|---|
|--workdir /work|コンテナが起動した時の作業ディレクトリを\workに指定。|
|-v $(pwd)/work:/work|-vはコンテナが共有するディレクトリを指定できます。|
|-p 指定されたポート番号:8888|指定したポート番号をコンテナ内のポート番号と紐付けます。|

---

## Docker コンテナの作成

```
docker run --gpus all -it --name $(whoami) --workdir /work -v $(pwd)/work:/work 
-p 指定されたポート番号:8888 cuda1170_ubuntu1804_pytorch_is_latest bash
```

|オプション名|機能|
|---|---|
|cuda1170_ubuntu1804_pytorch_is_latest|私が用意したDocker imageの名前です。|
|bash|コンテナが起動した際に一番はじめに実行されるプログラムの名前です。|

---

## Docker コンテナに慣れよう

先程のコマンドを実行すると、Docker コンテナの中に入れているはずです。sshで接続したときと同じ要領で、すでにDocker コンテナ(という仮想的なパソコン)にrootという名前のユーザーでログインされている状態です。

今までのように、コマンドが実行できます。例えば、なにかファイルを作ってみましょう。

```
echo "アメンボ青いなあいうえお" >> test.txt
```
これで「アメンボ青いなあいうえお」といった内容の`test.txt`が作成されたはずです。
```
cat test.txt
```

---

## Dockerから抜ける

```
exit
```
と入力することで抜けることができます。これもsshと同じですね。

Dockerコンテナはパソコンの中にパソコンを作ってそこにsshで接続していると見ると少しわかりやすいかもしれません。

---

## Docker コンテナの状態

よく見る状態としては以下の2つがあります。
|状態名|状態|
|---|---|
|existed|exit等でコンテナから抜けたりdcker stopコマンドでコンテナを停止させた状態。コンテナは存在するが実行はされていない。|
|up|docker runで起動させたりduocker startでコンテナを実行している状態。|

少しだけ、プログラミングの用語を使うならexistedもupもどちらもインスタンス(実行をしようと思えばできる状態)、メモリ上にあるのがup、メモリ上にはないのがexistedとなります。

---

## existedのDockerコンテナに再び入る

```
docker start コンテナ名
```
でコンテナをupの状態にできる。その後、

```
docker exec -i -t コンテナ名 bash
```

でbashに入ることができる。なお、コンテナ名は$(whoami)、つまり自分のユーザー名になっているはずなのでユーザー名を入れてください。

---

## dockerコンテナでJupyter labを起動する

まずはdocker コンテナの作業ディレクトリを`\work`に移動してください。
```
cd \work
```

その後以下のコマンドを入力してください。
```
upyter-lab --no-browser --port=8888 --ip=0.0.0.0 --allow-root --NotebookApp.token=''
```

その後、自分のパソコンのwebブラウザに以下のURLを入力してください。
```
http://133.2.194.164:指定されたポート番号/lab
```

以上で接続完了です。なお、dockerコンテナ内で`Ctrl + C`をすればJupyter labを停止できます。

---

## pythonを動かしてみる

さて、これでssh、docker、Jupyter labでPythonの実行環境は構築できました。

"Notebook"の"Python 3"をマウスでクリックしてください。

これでipynbファイルが作成されます。ipynbファイルは対話的にpythonを実行でき、データ解析や機械学習のような使い捨てのプログラムを書くのに最適です。

操作は実演しますが、セルにプログラムを書いて`Shift + Enter`でセル単位でプログラムが実行されます。

---

## 次回予告

puthnの基本的な構文や式を解説し、Jupyter lab上で手を動かして確認してもらいます。

---

## 補足

実はコマンドプロンプトでsshをやらなくてもvscodeにはリモート側にvscodeサーバーを立ててリモート先のファイルをvscodeで動かせるプラグインがあったり、Jupyter labの対話的実行環境をブラウザ上でなく、vscode上に作れるプラグインもあったりします。私は前時代的な人間なのか、少し面倒くさい操作をしたほうが(苦しんだほうが)勉強になると思ってこーゆうやり方でやっています。わかる方は調べてやってもらっても構いません(というか別に簡単です。)。

今回はお試しなのでvscodeは特に解説はしませんが、4年生になった時にもしAI開発に携わることがあったら(もちろん春山研でなくともです。)便利なのでぜひ調べてみてください。

